# Progress Log

## 2026-02-22 10:21:54 UTC

- Reviewed `packages-web-cutover-plan.md` and selected the next actionable Phase A task.
- Implemented Phase A foundations:
  - Added layer aliases in `packages/web/tsconfig.json` for `@/app/*`, `@/pages/*`, `@/widgets/*`, `@/features/*`, `@/entities/*`, `@/shared/*`, `@/integrations/*`.
  - Added matching Vite aliases in `packages/web/vite.config.ts`.
  - Added ESLint layer-boundary rules in `packages/web/.eslintrc.cjs` for `widgets`, `features`, `entities`, `shared`, and `integrations` paths.
- Updated plan status in `packages-web-cutover-plan.md`:
  - Marked Phase A alias + import-boundary tasks complete.
  - Marked Phase A as in progress (2/4 complete).
  - Clarified that the legacy-folder freeze should be enforced via a CI guard script.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Implement Phase A compatibility/guardrails:
  1. Add temporary compatibility re-export shims for first moved modules.
  2. Add CI guard script to block net-new files under `src/components/ui-new` and `src/components/dialogs`.

## 2026-02-22 10:25:23 UTC

- Assessed next Phase A item and implemented the legacy-path freeze guard.
- Added CI/local guard command:
  - New script: `scripts/check-legacy-frontend-paths.sh`
  - New npm script: `web:legacy-path-guard`
- Added allowlist baseline for currently tracked legacy files:
  - `scripts/legacy-frontend-paths-allowlist.txt`
- Wired guard into CI frontend checks in `.github/workflows/test.yml`.
  - Added script + allowlist to frontend path filters.
  - Added guard command into concurrent frontend check commands.
- New information discovered and handled:
  - Base-branch diff was not reliable yet because branch/main legacy trees are not aligned.
  - Switched guard strategy to committed allowlist baseline for stable enforcement.
- Updated plan (`packages-web-cutover-plan.md`):
  - Kept Phase A at 3/4 complete.
  - Marked legacy freeze task complete with script + allowlist + CI wiring details.
  - Documented allowlist rationale.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - `pnpm run web:legacy-path-guard`
  - All passed.

### Next change

- Implement remaining Phase A task:
  1. Add temporary compatibility re-export files for the first module moves in Phase B.

## 2026-02-22 10:31:02 UTC

- Assessed and implemented the remaining Phase A task: compatibility re-export shims.
- Created first canonical app-shell modules under `src/app/*`:
  - `src/app/entry/App.tsx`
  - `src/app/entry/Bootstrap.tsx`
  - `src/app/router/index.ts`
  - `src/app/providers/ConfigProvider.tsx`
  - `src/app/providers/ThemeProvider.tsx`
  - `src/app/providers/NewDesignScope.tsx`
  - `src/app/providers/VSCodeScope.tsx`
- Added compatibility shim files at legacy paths so existing imports remain valid:
  - `src/App.tsx`
  - `src/main.tsx`
  - `src/Router.tsx`
  - `src/components/ConfigProvider.tsx`
  - `src/components/ThemeProvider.tsx`
  - `src/components/ui-new/scope/NewDesignScope.tsx`
  - `src/components/ui-new/scope/VSCodeScope.tsx`
- Updated key route imports to canonical app paths:
  - `src/routes/__root.tsx`
  - `src/routes/_app.tsx`
  - `src/routes/index.tsx`
  - `src/routes/onboarding.tsx`
  - `src/routes/onboarding_.sign-in.tsx`
  - `src/routes/workspaces.$workspaceId.vscode.tsx`
- Updated ESLint exceptions so `NiceModal` usage remains valid in moved provider files.
- New compatibility issue discovered and fixed:
  - `src/lib/auth/tokenManager.ts` expects `queryClient` exported from `src/main.tsx`.
  - Restored this via shim export: `src/main.tsx` now re-exports `queryClient` from `src/app/entry/Bootstrap.tsx`.
- Updated plan (`packages-web-cutover-plan.md`):
  - Marked Phase A complete.
  - Marked compatibility re-export task complete with specific moved/shimmed module list.
  - Marked Phase B as in progress with initial app-shell move note.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - `pnpm run web:legacy-path-guard`
  - All passed.

### Next change

- Continue Phase B app-shell relocation:
  1. Move remaining bootstrap/provider-related imports to canonical `@/app/*` paths.
  2. Begin `pages/ui-new/*` to `pages/<domain>/*` relocation with shims.

