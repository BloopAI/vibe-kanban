# Progress Log

## 2026-02-22 10:21:54 UTC

- Reviewed `packages-web-cutover-plan.md` and selected the next actionable Phase A task.
- Implemented Phase A foundations:
  - Added layer aliases in `packages/web/tsconfig.json` for `@/app/*`, `@/pages/*`, `@/widgets/*`, `@/features/*`, `@/entities/*`, `@/shared/*`, `@/integrations/*`.
  - Added matching Vite aliases in `packages/web/vite.config.ts`.
  - Added ESLint layer-boundary rules in `packages/web/.eslintrc.cjs` for `widgets`, `features`, `entities`, `shared`, and `integrations` paths.
- Updated plan status in `packages-web-cutover-plan.md`:
  - Marked Phase A alias + import-boundary tasks complete.
  - Marked Phase A as in progress (2/4 complete).
  - Clarified that the legacy-folder freeze should be enforced via a CI guard script.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Implement Phase A compatibility/guardrails:
  1. Add temporary compatibility re-export shims for first moved modules.
  2. Add CI guard script to block net-new files under `src/components/ui-new` and `src/components/dialogs`.

## 2026-02-22 10:25:23 UTC

- Assessed next Phase A item and implemented the legacy-path freeze guard.
- Added CI/local guard command:
  - New script: `scripts/check-legacy-frontend-paths.sh`
  - New npm script: `web:legacy-path-guard`
- Added allowlist baseline for currently tracked legacy files:
  - `scripts/legacy-frontend-paths-allowlist.txt`
- Wired guard into CI frontend checks in `.github/workflows/test.yml`.
  - Added script + allowlist to frontend path filters.
  - Added guard command into concurrent frontend check commands.
- New information discovered and handled:
  - Base-branch diff was not reliable yet because branch/main legacy trees are not aligned.
  - Switched guard strategy to committed allowlist baseline for stable enforcement.
- Updated plan (`packages-web-cutover-plan.md`):
  - Kept Phase A at 3/4 complete.
  - Marked legacy freeze task complete with script + allowlist + CI wiring details.
  - Documented allowlist rationale.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - `pnpm run web:legacy-path-guard`
  - All passed.

### Next change

- Implement remaining Phase A task:
  1. Add temporary compatibility re-export files for the first module moves in Phase B.

## 2026-02-22 10:31:02 UTC

- Assessed and implemented the remaining Phase A task: compatibility re-export shims.
- Created first canonical app-shell modules under `src/app/*`:
  - `src/app/entry/App.tsx`
  - `src/app/entry/Bootstrap.tsx`
  - `src/app/router/index.ts`
  - `src/app/providers/ConfigProvider.tsx`
  - `src/app/providers/ThemeProvider.tsx`
  - `src/app/providers/NewDesignScope.tsx`
  - `src/app/providers/VSCodeScope.tsx`
- Added compatibility shim files at legacy paths so existing imports remain valid:
  - `src/App.tsx`
  - `src/main.tsx`
  - `src/Router.tsx`
  - `src/components/ConfigProvider.tsx`
  - `src/components/ThemeProvider.tsx`
  - `src/components/ui-new/scope/NewDesignScope.tsx`
  - `src/components/ui-new/scope/VSCodeScope.tsx`
- Updated key route imports to canonical app paths:
  - `src/routes/__root.tsx`
  - `src/routes/_app.tsx`
  - `src/routes/index.tsx`
  - `src/routes/onboarding.tsx`
  - `src/routes/onboarding_.sign-in.tsx`
  - `src/routes/workspaces.$workspaceId.vscode.tsx`
- Updated ESLint exceptions so `NiceModal` usage remains valid in moved provider files.
- New compatibility issue discovered and fixed:
  - `src/lib/auth/tokenManager.ts` expects `queryClient` exported from `src/main.tsx`.
  - Restored this via shim export: `src/main.tsx` now re-exports `queryClient` from `src/app/entry/Bootstrap.tsx`.
- Updated plan (`packages-web-cutover-plan.md`):
  - Marked Phase A complete.
  - Marked compatibility re-export task complete with specific moved/shimmed module list.
  - Marked Phase B as in progress with initial app-shell move note.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - `pnpm run web:legacy-path-guard`
  - All passed.

### Next change

- Continue Phase B app-shell relocation:
  1. Move remaining bootstrap/provider-related imports to canonical `@/app/*` paths.
  2. Begin `pages/ui-new/*` to `pages/<domain>/*` relocation with shims.


## 2026-02-22 10:35:11 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next Phase B migration slice.
- Implemented app-shell import standardization:
  - Replaced remaining `ConfigProvider` and `ThemeProvider` imports with canonical `@/app/providers/*` paths across web source files.
- Implemented page relocation kickoff for Phase B:
  - Moved route-level pages from `src/pages/ui-new/*` into domain folders:
    - `src/pages/onboarding/*`
    - `src/pages/migrate/*`
    - `src/pages/workspaces/*`
    - `src/pages/projects/*`
    - `src/pages/root/*`
  - Added temporary compatibility shims at legacy paths under `src/pages/ui-new/*` that re-export from the new canonical page paths.
  - Updated all `src/routes/*` imports to the new `@/pages/<domain>/*` paths.
- Updated plan (`packages-web-cutover-plan.md`):
  - Marked Phase B items complete for:
    1. app-shell bootstrap/router/provider relocation + canonical provider imports
    2. page relocation from `pages/ui-new` into domain folders
    3. route imports updated to new page paths
  - Left Phase B global style entrypoint move pending.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Complete remaining Phase B item:
  1. Move global style entrypoints/imports from `src/styles/*` usage into `src/app/styles/*` with compatibility shims as needed.

## 2026-02-22 10:37:25 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the remaining Phase B task.
- Implemented Phase B global style relocation:
  - Moved style entrypoint files from `src/styles/*` to canonical app paths under `src/app/styles/*`:
    - `src/app/styles/new/index.css`
    - `src/app/styles/diff-style-overrides.css`
    - `src/app/styles/edit-diff-overrides.css`
  - Updated TypeScript imports to canonical `@/app/styles/*` paths in provider and normalized-conversation components.
  - Added compatibility shim CSS files at legacy paths under `src/styles/*` that `@import` the new app-style locations.
- Updated plan (`packages-web-cutover-plan.md`):
  - Marked final Phase B task complete (global style entrypoints to `src/app/styles`).
  - Marked Phase B complete in the Status section.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Start Phase C vertical migrations with the onboarding/migration slice:
  1. Move migrate/onboarding flow containers from `src/components/ui-new/containers/*` into a feature-owned folder (e.g. `src/features/migration/ui/*` and `src/features/onboarding/ui/*`) with compatibility shims.
  2. Update page imports to use the new feature paths.

## 2026-02-22 10:39:36 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the first Phase C vertical migration slice.
- Implemented migration feature relocation:
  - Moved migration flow containers from legacy paths under
    `src/components/ui-new/containers/` into canonical feature paths under
    `src/features/migration/ui/`:
    - `MigrateLayout.tsx`
    - `MigrateIntroductionContainer.tsx`
    - `MigrateChooseProjectsContainer.tsx`
    - `MigrateMigrateContainer.tsx`
    - `MigrateFinishContainer.tsx`
  - Updated `src/pages/migrate/MigratePage.tsx` to import
    `@/features/migration/ui/MigrateLayout`.
  - Added temporary compatibility re-export shims at legacy
    `src/components/ui-new/containers/Migrate*` paths.
- New information discovered and handled:
  - ESLint import-boundary rules reject same-layer feature imports via
    `@/features/*` from inside feature files.
  - Updated `src/features/migration/ui/MigrateLayout.tsx` to use relative
    sibling imports for local feature modules.
- Updated plan (`packages-web-cutover-plan.md`):
  - Marked Phase C as in progress.
  - Documented completed migration-slice relocation and onboarding status
    (onboarding has no dedicated `ui-new` containers yet; still page-local).
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C onboarding/migration slice:
  1. Extract onboarding page-local composition into `src/features/onboarding/ui/*` modules.
  2. Update onboarding pages to import those feature modules.
  3. Add temporary compatibility re-exports if any legacy imports are needed.

## 2026-02-22 10:42:06 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next Phase C onboarding slice.
- Implemented onboarding feature extraction:
  - Moved onboarding implementations from page-local files into feature-owned files:
    - `src/features/onboarding/ui/LandingPage.tsx`
    - `src/features/onboarding/ui/OnboardingSignInPage.tsx`
  - Converted page files into thin route-level wrappers:
    - `src/pages/onboarding/LandingPage.tsx`
    - `src/pages/onboarding/OnboardingSignInPage.tsx`
- New information discovered and handled:
  - Feature layer lint boundaries prohibit importing `@/app/*` directly from `src/features/*`.
  - Added lightweight hook adapters to bridge app providers without direct `@/app/*` imports in feature files:
    - `src/hooks/useTheme.ts`
    - `src/hooks/useUserSystem.ts`
  - Updated onboarding feature files to use those adapters.
- Updated plan (`packages-web-cutover-plan.md`):
  - Expanded Phase C progress notes to include onboarding extraction and the adapter-hook boundary workaround.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C with workspace route surface:
  1. Move workspace page-level composition from legacy `src/components/ui-new/containers/WorkspacesLayout.tsx` into `src/features/workspace/ui/*` (or equivalent), with compatibility shim.
  2. Update imports to canonical feature paths and use hook adapters where needed for app-provider access.

## 2026-02-22 10:46:05 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next Phase C workspace slice.
- Implemented workspace feature extraction (page-level composition):
  - Moved
    `src/components/ui-new/containers/WorkspacesLayout.tsx`
    -> `src/features/workspace/ui/WorkspacesLayout.tsx`.
  - Updated `src/pages/workspaces/Workspaces.tsx` to import from
    `@/features/workspace/ui/WorkspacesLayout`.
  - Added temporary compatibility shim at legacy path:
    `src/components/ui-new/containers/WorkspacesLayout.tsx` re-exports from
    `@/features/workspace/ui/WorkspacesLayout`.
- New information discovered and handled:
  - Feature layer boundary still disallows direct `@/app/*` imports.
  - Updated moved file to consume `useUserSystem` via hook adapter
    (`@/hooks/useUserSystem`) instead of importing from
    `@/app/providers/ConfigProvider`.
- Updated plan (`packages-web-cutover-plan.md`):
  - Added Phase C progress bullets for the workspace layout move, page import
    update, and legacy compatibility shim.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C workspace route surface:
  1. Move VSCode workspace page-level composition from
     `src/pages/workspaces/VSCodeWorkspacePage.tsx` into
     `src/features/workspace/ui/VSCodeWorkspacePage.tsx` with a page wrapper.
  2. Keep compatibility paths stable and apply hook adapters where app-layer
     imports would violate feature boundaries.

## 2026-02-22 10:48:02 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next queued Phase C workspace task.
- Implemented VSCode workspace page extraction:
  - Moved page-level composition:
    - `src/pages/workspaces/VSCodeWorkspacePage.tsx`
      -> `src/features/workspace/ui/VSCodeWorkspacePage.tsx`
  - Converted `src/pages/workspaces/VSCodeWorkspacePage.tsx` into a thin
    route-level wrapper re-exporting from
    `@/features/workspace/ui/VSCodeWorkspacePage`.
- Compatibility and routing impact:
  - Existing route import in
    `src/routes/workspaces.$workspaceId.vscode.tsx` remains stable via the
    page wrapper.
  - Existing legacy shim
    `src/pages/ui-new/VSCodeWorkspacePage.tsx` continues to resolve through
    the canonical page path.
- Updated plan (`packages-web-cutover-plan.md`):
  - Added Phase C progress bullets for the VSCode workspace page move and
    wrapper conversion.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C vertical migrations with the project-kanban route surface:
  1. Move `src/pages/projects/ProjectKanban.tsx` composition into
     `src/features/kanban/ui/ProjectKanban.tsx`.
  2. Keep `src/pages/projects/ProjectKanban.tsx` as a thin wrapper and
     preserve route imports.

## 2026-02-22 10:49:59 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next Phase C project-kanban slice.
- Implemented project-kanban feature extraction:
  - Moved page-level composition:
    - `src/pages/projects/ProjectKanban.tsx`
      -> `src/features/kanban/ui/ProjectKanban.tsx`
  - Converted `src/pages/projects/ProjectKanban.tsx` into a thin
    route-level wrapper re-exporting from
    `@/features/kanban/ui/ProjectKanban`.
- Compatibility and routing impact:
  - Existing project route imports continue to work via the page wrapper.
  - Existing legacy shim
    `src/pages/ui-new/ProjectKanban.tsx` continues to resolve through the
    canonical page path.
- Updated plan (`packages-web-cutover-plan.md`):
  - Added Phase C progress bullets for the project-kanban page move and
    wrapper conversion.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C kanban vertical slice:
  1. Move `src/components/ui-new/containers/KanbanContainer.tsx` into
     `src/features/kanban/ui/KanbanContainer.tsx` with a compatibility shim.
  2. Update imports (including `ProjectKanban`) to the canonical feature path.

## 2026-02-22 10:53:17 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next queued Phase C kanban hotspot.
- Implemented kanban container migration:
  - Moved container composition:
    - `src/components/ui-new/containers/KanbanContainer.tsx`
      -> `src/features/kanban/ui/KanbanContainer.tsx`
  - Converted legacy container file into a compatibility shim re-exporting from
    `@/features/kanban/ui/KanbanContainer`.
  - Updated `src/features/kanban/ui/ProjectKanban.tsx` to import local
    canonical path `./KanbanContainer`.
- New information confirmed and handled:
  - Feature layer boundary constraints still apply for app-provider imports.
  - Updated moved `KanbanContainer` to use `@/hooks/useUserSystem` adapter
    instead of importing from `@/app/providers/ConfigProvider`.
- Updated plan (`packages-web-cutover-plan.md`):
  - Added Phase C progress bullets for the `KanbanContainer` move,
    canonical import update, compatibility shim, and adapter-hook usage.
  - Marked `KanbanContainer` hotspot as completed in the Phase C hotspot list.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C hotspot decomposition:
  1. Move `src/components/ui-new/containers/SessionChatBoxContainer.tsx`
     into a feature-owned workspace-chat path with compatibility shim.
  2. Move `src/components/ui-new/containers/NewDisplayConversationEntry.tsx`
     into the same feature slice and update imports to canonical paths.

## 2026-02-22 10:56:42 UTC

- Reviewed `packages-web-cutover-plan.md` and `progress.txt` and selected the next queued Phase C workspace-chat hotspot migration.
- Implemented workspace-chat container migration:
  - Moved `src/components/ui-new/containers/SessionChatBoxContainer.tsx`
    -> `src/features/workspace-chat/ui/SessionChatBoxContainer.tsx`.
  - Moved `src/components/ui-new/containers/NewDisplayConversationEntry.tsx`
    -> `src/features/workspace-chat/ui/NewDisplayConversationEntry.tsx`.
  - Added temporary compatibility shims at the legacy paths so existing
    imports continue to resolve during phased cutover.
- Updated imports to canonical feature paths:
  - `src/components/ui-new/containers/WorkspacesMainContainer.tsx`
  - `src/components/ui-new/containers/ProjectRightSidebarContainer.tsx`
  - `src/components/ui-new/containers/ConversationListContainer.tsx`
- New information discovered and handled:
  - Feature lint boundaries still prohibit `@/app/*` imports from
    `src/features/*`.
  - Updated moved files to consume hook adapters instead:
    `@/hooks/useUserSystem` and `@/hooks/useTheme`.
  - Kept `src/features/workspace/ui/VSCodeWorkspacePage.tsx` on the legacy
    shim import path for now to avoid introducing cross-feature relative
    imports under current layer restrictions.
- Updated plan (`packages-web-cutover-plan.md`):
  - Added Phase C progress bullets for the two workspace-chat moves,
    canonical import updates, shims, and adapter-hook usage.
  - Marked both Phase C hotspots complete:
    `SessionChatBoxContainer` and `NewDisplayConversationEntry`.
- Quality checks run:
  - `pnpm run format`
  - `pnpm run web:check`
  - `pnpm run web:lint`
  - All passed.

### Next change

- Continue Phase C hotspot decomposition:
  1. Start extracting `src/components/ui-new/actions/index.ts` into a
     feature-owned command/actions slice (with compatibility exports).
  2. Follow with `src/lib/api.ts` domain split once action dependencies are
     clearer.
