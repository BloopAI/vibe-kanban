use std::env;
use std::path::Path;
use ts_rs::TS;

// Import all the types we want to export using the library crate

fn main() {
    let shared_path = Path::new("../shared");

    // Create the shared directory if it doesn't exist
    std::fs::create_dir_all(shared_path).unwrap();

    println!("Generating TypeScript types...");

    // Set environment variable to configure ts-rs output directory
    env::set_var("TS_RS_EXPORT_DIR", shared_path.to_str().unwrap());

    // // Export TypeScript types for each struct using ts-rs export functionality
    // bloop_backend::models::ApiResponse::<()>::export().unwrap();
    // bloop_backend::models::Project::export().unwrap();
    // bloop_backend::models::CreateProject::export().unwrap();
    // bloop_backend::models::UpdateProject::export().unwrap();
    // bloop_backend::models::CreateUser::export().unwrap();
    // bloop_backend::models::UpdateUser::export().unwrap();
    // bloop_backend::models::LoginRequest::export().unwrap();
    // bloop_backend::models::LoginResponse::export().unwrap();
    // bloop_backend::models::UserResponse::export().unwrap();

    // Generate consolidated types.ts file
    let consolidated_content = format!(
        r#"// This file was generated by [ts-rs](https://github.com/Aleph-Alpha/ts-rs). Do not edit this file manually.
// Auto-generated from Rust backend types using ts-rs

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}"#,
        bloop_backend::models::ApiResponse::<()>::decl(),
        bloop_backend::executor::ExecutorConfig::decl(),
        bloop_backend::models::project::CreateProject::decl(),
        bloop_backend::models::project::Project::decl(),
        bloop_backend::models::project::UpdateProject::decl(),
        bloop_backend::models::task::CreateTask::decl(),
        bloop_backend::models::task::TaskStatus::decl(),
        bloop_backend::models::task::Task::decl(),
        bloop_backend::models::task::TaskWithAttemptStatus::decl(),
        bloop_backend::models::task::UpdateTask::decl(),
        bloop_backend::models::task_attempt::TaskAttemptStatus::decl(),
        bloop_backend::models::task_attempt::TaskAttempt::decl(),
        bloop_backend::models::task_attempt::CreateTaskAttempt::decl(),
        bloop_backend::models::task_attempt::UpdateTaskAttempt::decl(),
        bloop_backend::models::task_attempt_activity::TaskAttemptActivity::decl(),
        bloop_backend::models::task_attempt_activity::CreateTaskAttemptActivity::decl(),
        bloop_backend::models::user::CreateUser::decl(),
        bloop_backend::models::user::UpdateUser::decl(),
        bloop_backend::models::user::UserResponse::decl(),
        bloop_backend::routes::filesystem::DirectoryEntry::decl(),
        bloop_backend::models::task_attempt::DiffChunkType::decl(),
        bloop_backend::models::task_attempt::DiffChunk::decl(),
        bloop_backend::models::task_attempt::FileDiff::decl(),
        bloop_backend::models::task_attempt::WorktreeDiff::decl(),
    );

    std::fs::write(shared_path.join("types.ts"), consolidated_content).unwrap();

    println!("TypeScript types generated successfully in ../shared/");
}
