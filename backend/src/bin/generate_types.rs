use std::env;
use std::path::Path;
use ts_rs::TS;

// Import all the types we want to export using the library crate

fn main() {
    let shared_path = Path::new("../shared");

    // Create the shared directory if it doesn't exist
    std::fs::create_dir_all(shared_path).unwrap();

    println!("Generating TypeScript types...");

    // Set environment variable to configure ts-rs output directory
    env::set_var("TS_RS_EXPORT_DIR", shared_path.to_str().unwrap());

    // Generate consolidated types.ts file
    let consolidated_content = format!(
        r#"// This file was generated by [ts-rs](https://github.com/Aleph-Alpha/ts-rs). Do not edit this file manually.
// Auto-generated from Rust backend types using ts-rs

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}

export {}"#,
        vibe_kanban::models::ApiResponse::<()>::decl(),
        vibe_kanban::executor::ExecutorConfig::decl(),
        vibe_kanban::models::project::CreateProject::decl(),
        vibe_kanban::models::project::Project::decl(),
        vibe_kanban::models::project::UpdateProject::decl(),
        vibe_kanban::models::project::SearchResult::decl(),
        vibe_kanban::models::project::SearchMatchType::decl(),
        vibe_kanban::models::task::CreateTask::decl(),
        vibe_kanban::models::task::TaskStatus::decl(),
        vibe_kanban::models::task::Task::decl(),
        vibe_kanban::models::task::TaskWithAttemptStatus::decl(),
        vibe_kanban::models::task::UpdateTask::decl(),
        vibe_kanban::models::task_attempt::TaskAttemptStatus::decl(),
        vibe_kanban::models::task_attempt::TaskAttempt::decl(),
        vibe_kanban::models::task_attempt::CreateTaskAttempt::decl(),
        vibe_kanban::models::task_attempt::UpdateTaskAttempt::decl(),
        vibe_kanban::models::task_attempt_activity::TaskAttemptActivity::decl(),
        vibe_kanban::models::task_attempt_activity::CreateTaskAttemptActivity::decl(),
        vibe_kanban::routes::filesystem::DirectoryEntry::decl(),
        vibe_kanban::models::task_attempt::DiffChunkType::decl(),
        vibe_kanban::models::task_attempt::DiffChunk::decl(),
        vibe_kanban::models::task_attempt::FileDiff::decl(),
        vibe_kanban::models::task_attempt::WorktreeDiff::decl(),
    );

    std::fs::write(shared_path.join("types.ts"), consolidated_content).unwrap();

    println!("TypeScript types generated successfully in ../shared/");
}
